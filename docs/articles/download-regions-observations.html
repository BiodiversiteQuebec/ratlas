<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Download observations by region from Atlas • ratlas</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Download observations by region from Atlas">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ratlas</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/database-access-functions.html">Functions to directly access the database ressources</a></li>
    <li><a class="dropdown-item" href="../articles/download-regions-observations.html">Download observations by region from Atlas</a></li>
    <li><a class="dropdown-item" href="../articles/post-dataset.html">Write and insert dataset metadata to Atlas</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="download-regions-observations_files/kePrint-0.0.1/kePrint.js"></script><link href="download-regions-observations_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Download observations by region from Atlas</h1>
            
      

      <div class="d-none name"><code>download-regions-observations.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="downloading-observations-by-region">Downloading observations by region<a class="anchor" aria-label="anchor" href="#downloading-observations-by-region"></a>
</h2>
<p>Regions shown in the Biodiversité Québec atlas portal can be accessed
through the <code>ratlas</code> package and be used to filter downloaded
observations. Regions are organized by type (ie. Ecological Region,
Administrative Region, and Hexagonal Grid) and each region type is
organized by scale. It is recommended to explore regions using the
Biodiversité Québec Atlas web application to determine the region type
and scale of interest.</p>
<p>For this exercices we want to only return the Municipalities of
Quebec. Specifically, we will extract observations for the city of
Sherbrooke in 2002.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ratlas</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:ratlas':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     db_write_table</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="section level3">
<h3 id="list-regions-available-in-the-atlas-portal">List regions available in the atlas portal<a class="anchor" aria-label="anchor" href="#list-regions-available-in-the-atlas-portal"></a>
</h3>
<p>The <code><a href="../reference/get_regions.html">get_regions()</a></code> function returns a data frame with the
regions available in the atlas portal. The function returns a data frame
with the following columns:</p>
<ul>
<li>
<code>fid</code>: the unique identifier of the region</li>
<li>
<code>type</code>: the type of region. Can be one of
<code>cadre_eco</code>, <code>admin</code>, and <code>hex</code>
</li>
<li>
<code>scale</code>: integer for the scale of the region. Example : 1
for the province of Quebec, 2 for the administrative regions, 3 for MRC,
4 for the Municipalities</li>
<li>
<code>name</code>: name of the region. Example : “Quebec”,
“Montreal”, “Laurentides”</li>
<li>
<code>scale_desc</code>: description of the scale.</li>
</ul>
<p>Running the function without any parameters will return all regions
in the atlas. This can be a very large dataset and may take a long time
to download. To explore the regions, it is recommended to use the
<code>id</code> parameter to return a specific region or the
<code>type</code> parameter to return a specific type of region. It is
also possible to exclude the geometry from the results by setting the
<code>geometry</code> parameter to <code>FALSE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regions_desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_regions.html">get_regions</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">regions_desc</span>, <span class="fl">20</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
fid
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
scale
</th>
<th style="text-align:left;">
scale_desc
</th>
<th style="text-align:left;">
name
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
admin
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Région administrative
</td>
<td style="text-align:left;">
Montérégie
</td>
</tr>
<tr>
<td style="text-align:right;">
633273
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
698412
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
858059
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Niveau 4
</td>
<td style="text-align:left;">
Buttons du réservoir Gouin
</td>
</tr>
<tr>
<td style="text-align:right;">
858060
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Niveau 2
</td>
<td style="text-align:left;">
Basses-terres du lac Témiscamingue
</td>
</tr>
<tr>
<td style="text-align:right;">
858086
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Niveau 4
</td>
<td style="text-align:left;">
Buttons du réservoir Robert-Bourassa
</td>
</tr>
<tr>
<td style="text-align:right;">
134
</td>
<td style="text-align:left;">
admin
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Territoire autochtone
</td>
<td style="text-align:left;">
Whapmagoostui
</td>
</tr>
<tr>
<td style="text-align:right;">
698426
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
858113
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:left;">
Niveau 3
</td>
<td style="text-align:left;">
Plateau septentrional de la Péninsule gaspésienne
</td>
</tr>
<tr>
<td style="text-align:right;">
859302
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Niveau 2
</td>
<td style="text-align:left;">
Collines La Vérendrye
</td>
</tr>
<tr>
<td style="text-align:right;">
859305
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
Niveau 2
</td>
<td style="text-align:left;">
Péninsule de la Gaspésie
</td>
</tr>
<tr>
<td style="text-align:right;">
698427
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
698428
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
698429
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
859733
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Niveau 4
</td>
<td style="text-align:left;">
Buttes du lac Mantouchiche
</td>
</tr>
<tr>
<td style="text-align:right;">
859734
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Niveau 4
</td>
<td style="text-align:left;">
Buttons du lac Hore
</td>
</tr>
<tr>
<td style="text-align:right;">
860092
</td>
<td style="text-align:left;">
cadre_eco
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Niveau 4
</td>
<td style="text-align:left;">
Plaine bosselée du lac Atachikami
</td>
</tr>
<tr>
<td style="text-align:right;">
693183
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
698430
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
<tr>
<td style="text-align:right;">
698431
</td>
<td style="text-align:left;">
hex
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
5 km
</td>
<td style="text-align:left;">
Nord-du-Québec
</td>
</tr>
</tbody>
</table>
<p>Let’s filter the results to only return the Municipalities of Quebec.
And search the results for the city of Sherbrooke.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">municipalities_desc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_regions.html">get_regions</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"admin"</span>, scale <span class="op">=</span> <span class="fl">4</span>, geometry <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">sherbrooke</span> <span class="op">&lt;-</span> <span class="va">municipalities_desc</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Sherbrooke"</span><span class="op">)</span></span>
<span><span class="va">sherbrooke</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;">
fid
</th>
<th style="text-align:left;">
type
</th>
<th style="text-align:right;">
scale
</th>
<th style="text-align:left;">
scale_desc
</th>
<th style="text-align:left;">
name
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
749
</td>
<td style="text-align:left;">
admin
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:left;">
Municipalité
</td>
<td style="text-align:left;">
Sherbrooke
</td>
</tr></tbody>
</table>
</div>
<div class="section level3">
<h3 id="count-observations-for-a-region">Count observations for a region<a class="anchor" aria-label="anchor" href="#count-observations-for-a-region"></a>
</h3>
<p>The database <code>obs_regions_taxa_datasets_counts</code> view
contains the number of observations for each region, taxa and datasets.
We can query it directly with the <code><a href="../reference/db_read_table.html">db_read_table()</a></code>
function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sherbrooke_count_response</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span></span>
<span>  table_name <span class="op">=</span> <span class="st">"obs_regions_taxa_datasets_counts"</span>,</span>
<span>  schema <span class="op">=</span> <span class="st">"atlas_api"</span>,</span>
<span>  fid <span class="op">=</span> <span class="va">sherbrooke</span><span class="op">$</span><span class="va">fid</span></span>
<span>  <span class="co"># id_taxa_obs = 735,</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Total number of observations for the city of Sherbrooke can be summed</span></span>
<span><span class="va">sherbrooke_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sherbrooke_count_response</span><span class="op">$</span><span class="va">count_obs</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of observations in Sherbrooke:"</span>, <span class="va">sherbrooke_count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of observations in Sherbrooke: 426867"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="download-observations-for-a-region">Download observations for a region<a class="anchor" aria-label="anchor" href="#download-observations-for-a-region"></a>
</h3>
<p>We can now use the <code>fid</code> value for the city of Sherbrooke
to download observations for the year 2002. The
<code><a href="../reference/get_observations.html">get_observations()</a></code> function returns a data frame with the
observations for the specified region. Other filter parameters can be
used to further filter the results. For example, we can filter the
results to only return observations for a specific year.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sherbrooke_observations</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_observations.html">get_observations</a></span><span class="op">(</span>region_fid <span class="op">=</span> <span class="va">sherbrooke</span><span class="op">$</span><span class="va">fid</span>, year <span class="op">=</span> <span class="fl">2002</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print number of observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Number of observations in Sherbrooke in 2002:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sherbrooke_observations</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Number of observations in Sherbrooke in 2002: 4557"</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vincent Beauregard, Benjamin Mercier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
