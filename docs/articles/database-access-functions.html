<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Functions to directly access the database ressources • ratlas</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Functions to directly access the database ressources">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ratlas</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/database-access-functions.html">Functions to directly access the database ressources</a>
    </li>
    <li>
      <a href="../articles/download-obs.html">Download observations from Atlas</a>
    </li>
    <li>
      <a href="../articles/download-regions-observations.html">Download observations by region from Atlas</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Functions to directly access the database
ressources</h1>
            
      

      <div class="hidden name"><code>database-access-functions.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>ratlas</code> package provides functions to interact with
Biodiversité Québec’s database <code>Atlas</code>. For most use cases,
<code>ratlas</code> get functions such as <code>get_taxa</code>,
<code>get_observations</code>, <code>get_datasets</code>, etc should be
used, as they are designed to be more user-friendly. However, in some
cases, it is useful to directly access the database ressources.</p>
<p>This vignette describes how to do so using low-level functions
<code>db_read_table</code> and <code>db_call_function</code>, on which
<code>ratlas</code> get functions are based and is intended for advanced
users.</p>
</div>
<div class="section level2">
<h2 id="atlas-database">Atlas database<a class="anchor" aria-label="anchor" href="#atlas-database"></a>
</h2>
<p>Atlas database is a PostgreSQL database. It contains several tables,
views, materialized views, functions, etc. Data is stored and made
available through those resources. While table store data, views and
materialized views behaves as tables and are used to store queries, and
functions are used to perform operations on the data. They are organized
by different schema, each of them representing a different application
layer of the database. The following schemas are available:</p>
<ul>
<li>
<code>public</code>: Raw biodiversity data is stored here in tables
such as <code>observations</code>, <code>taxa_obs</code>,
<code>datasets</code>, <code>variables</code>, <code>efforts</code>,
etc. This schema is relational, as joins between tables are required to
retrieve data. Data may be protected by access rights and require
authentication to be accessed through a token (see README).</li>
<li>
<code>api</code>: This schema contains views and functions that are
used to access data from the <code>public</code> schema. It performs
joins between tables, and returns data in a more user-friendly format.
This schema is used by the <code>ratlas</code> read/call functions. Data
may be protected by access rights and require authentication to be
accessed through a token (see README).</li>
<li>
<code>atlas-api</code>: This schema contains tables, views and
functions required for the operation of the <a href="https://biodiversite-quebec.ca/en/atlas" class="external-link">‘atlas web portal’</a>.
All displayed information and summary statistics are computed from
resources in this schema. Data at this layer is not protected by access
rights and can be accessed without authentication.</li>
</ul>
<p>Documentation for tables and functions are made availabe in atlas-db
repository documentation.</p>
</div>
<div class="section level2">
<h2 id="reading-tables-and-views-data">Reading tables and views data<a class="anchor" aria-label="anchor" href="#reading-tables-and-views-data"></a>
</h2>
<p>The db_read_table() function is used to read data from a PostgreSQL
table. It takes several arguments, including the name of the table, the
schema that the table belongs to, and the authentication token that is
required to access the database.</p>
<p>Here’s an example of how to use the db_read_table() function to read
data from a table named “taxa_obs” in the “public” schema:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ratlas</span><span class="op">)</span></span>
<span><span class="co"># Added a limit of 100 to simplify the process</span></span>
<span><span class="co"># Remove the limit argument if you want the whole table</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, limit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The db_read_table() function returns a data.frame object containing
the data from the table. The data.frame columns are named after the
table columns. The data.frame row names are the row numbers of the
table.</p>
<div class="section level3">
<h3 id="filtering-data-using-column-values">Filtering data using column values<a class="anchor" aria-label="anchor" href="#filtering-data-using-column-values"></a>
</h3>
<p>The db_read_table() function also allows you to filter the data that
is returned by specifying additional arguments. For example, you can use
the <code>...</code> argument to specify a filter condition:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, id <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, scientific_name <span class="op">=</span> <span class="st">'Acer saccharum'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">#&gt;       id scientific_name authorship rank    created_at   modified_at modified_by</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   <span style="text-decoration: underline;">7</span>278 Acer saccharum  Marsh.     species 2021-11-23T… 2021-11-23… postgres   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">939</span>205 Acer saccharum  Marshall   species 2024-01-07T… 2024-01-07… vbeaure    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: parent_scientific_name &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Using a list of values</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 8</span></span></span>
<span><span class="co">#&gt;      id scientific_name     authorship rank   created_at modified_at modified_by</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Prunus pensylvanica L. fil.    speci… 2021-11-1… 2021-11-19… vbeaure    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Sorbus americana    Marsh      speci… 2021-11-1… 2021-11-19… vbeaure    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: parent_scientific_name &lt;lgl&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, scientific_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Acer saccharum'</span>, <span class="st">'Acer rubrum'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 8</span></span></span>
<span><span class="co">#&gt;       id scientific_name authorship rank    created_at   modified_at modified_by</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   <span style="text-decoration: underline;">7</span>279 Acer rubrum     L.         species 2021-11-23T… 2021-11-23… postgres   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="text-decoration: underline;">928</span>393 Acer rubrum     L.         species 2024-01-07T… 2024-01-07… vbeaure    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   <span style="text-decoration: underline;">7</span>278 Acer saccharum  Marsh.     species 2021-11-23T… 2021-11-23… postgres   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> <span style="text-decoration: underline;">939</span>205 Acer saccharum  Marshall   species 2024-01-07T… 2024-01-07… vbeaure    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: parent_scientific_name &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="selecting-columns-and-limit-the-number-of-rows">Selecting columns and limit the number of rows<a class="anchor" aria-label="anchor" href="#selecting-columns-and-limit-the-number-of-rows"></a>
</h3>
<p>The limit and select arguments can be used to limit the number of
rows returned by the function and to select specific columns from the
table.</p>
<p>Those arguments are useful when working with large tables, as they
allow you to limit the amount of data that is returned by the
function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"scientific_name"</span><span class="op">)</span>, limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="returning-geometries">Returning geometries<a class="anchor" aria-label="anchor" href="#returning-geometries"></a>
</h3>
<p>Many tables in the database contain geometries. For example, the
<code>observations</code> table contains a <code>geom</code> column that
contains the location of the observation. By default, the
db_read_table() function returns a data.frame object with the geometry
column as a list of points. However, you can use the
<code>output_geometry</code> argument to return the data as a
<code>sf</code> object, made available by the <code>sf</code> package.
The <code>sf</code> object is our preferred format for working with
geometries in R.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regions</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"regions"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, output_geometry <span class="op">=</span> <span class="cn">TRUE</span>, type <span class="op">=</span> <span class="st">'admin'</span>, scale <span class="op">=</span> <span class="st">'2'</span><span class="op">)</span> <span class="co"># Administrative regions of Quebec</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"observations"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, output_geometry <span class="op">=</span> <span class="cn">TRUE</span>, within_quebec <span class="op">=</span> <span class="cn">TRUE</span>, limit <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the regions and the observations</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">regions</span><span class="op">$</span><span class="va">geom</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">geom</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="database-access-functions_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="paginating-results">Paginating results<a class="anchor" aria-label="anchor" href="#paginating-results"></a>
</h3>
<p>By default, the function paginates the results using a number of
500,000 rows per page, as prescribed by <code>.page_limit</code> default
value. If the table contains more, the function will automatically
download the results in multiple pages and concatenate them into a
single data frame.</p>
<p>You can customize the pagination behavior by specifying the limit and
offset parameters in the query. The db_read_table() function also
provides additional parameters to control the pagination process, such
as .n_pages and .page_limit.</p>
<p>Here’s an example of how to use the get_table_data() function to
download the 100 rows of a table, starting at row 200:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, limit <span class="op">=</span> <span class="fl">100</span>, offset <span class="op">=</span> <span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p>In this example, the results are paginated into multiple pages of 100
rows each.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"taxa_obs"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, .page_limit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="parallelization-of-requests">Parallelization of Requests<a class="anchor" aria-label="anchor" href="#parallelization-of-requests"></a>
</h3>
<p>To handle downloading data with very large number of rows, the
function makes requests in parallel using multiple cores. The
db_read_table() function provides an optional parameter,
<code>.cores</code>, to specify the number of cores to use for parallel
processing.</p>
<p>By default, the function downloads the results using parallelization
using 4 cores, as defined by default value of <code>.cores</code>. The
function will automatically determine the number of pages to download
and split the work across the specified number of cores. The results are
then combined into a single data frame.</p>
<p>Here’s an example of how to use the db_read_table() function to
download four pages of data in parallel using 4 cores:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_read_table.html">db_read_table</a></span><span class="op">(</span><span class="st">"observations"</span>, schema <span class="op">=</span> <span class="st">"public"</span>, .n_pages <span class="op">=</span> <span class="fl">4</span>, .cores <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="reading-functions-data">Reading functions data<a class="anchor" aria-label="anchor" href="#reading-functions-data"></a>
</h2>
<p>The db_call_function() function is used to read data from a
PostgreSQL function. It takes several arguments, including the name of
the function, the schema that the function belongs to, and the
authentication token that is required to access the database. Functions
arguments can be passed to the function using the <code>...</code>
argument.</p>
<p>Accepted arguments are described in the function documentation. For
example, the <code>atlas_api.obs_summary</code> function takes the
following optionnal arguments (<code>taxa_keys</code>,
<code>min_year</code>, <code>max_year</code>, <code>region_fid</code>,
<code>region_type</code>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_call_function.html">db_call_function</a></span><span class="op">(</span><span class="st">"obs_summary"</span>, schema <span class="op">=</span> <span class="st">"atlas_api"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 12</span></span></span>
<span><span class="co">#&gt;     fid obs_count taxa_count taxa_count_carrousel taxa_id_list   carrousel_info</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1  38<span style="text-decoration: underline;">392</span>931      <span style="text-decoration: underline;">25</span>176                <span style="text-decoration: underline;">36</span>860 <span style="color: #949494;">&lt;int [36,860]&gt;</span> <span style="color: #949494;">&lt;df [20 × 4]&gt;</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: taxa_filter_tags.taxa_tags_fr &lt;lgl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   taxa_filter_tags.taxa_tags_en &lt;lgl&gt;, region_filter_tags.tags_fr &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   region_filter_tags.tags_en &lt;chr&gt;, region_filter_tags.name_fr &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   region_filter_tags.name_en &lt;chr&gt;</span></span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db_call_function.html">db_call_function</a></span><span class="op">(</span><span class="st">"obs_summary"</span>, schema <span class="op">=</span> <span class="st">"atlas_api"</span>, taxa_keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, min_year <span class="op">=</span> <span class="fl">2010</span>, max_year <span class="op">=</span> <span class="fl">2015</span>, region_fid <span class="op">=</span> <span class="fl">1</span>, region_type <span class="op">=</span> <span class="st">'admin'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 12</span></span></span>
<span><span class="co">#&gt;     fid obs_count taxa_count taxa_count_carrousel taxa_id_list carrousel_info</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1      <span style="text-decoration: underline;">2</span>754          2                    2 <span style="color: #949494;">&lt;int [2]&gt;</span>    <span style="color: #949494;">&lt;df [2 × 4]&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 more variables: taxa_filter_tags.taxa_tags_fr &lt;list&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   taxa_filter_tags.taxa_tags_en &lt;list&gt;, region_filter_tags.tags_fr &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   region_filter_tags.tags_en &lt;chr&gt;, region_filter_tags.name_fr &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   region_filter_tags.name_en &lt;chr&gt;</span></span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Vincent Beauregard.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.9000.</p>
</div>

      </footer>
</div>






  </body>
</html>
